<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin - Registered Users</title>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, collection, getDocs, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDZUVChTTWtGm4R40wMWGrTYwyUk0FDahs",
    authDomain: "sklepaga-8790e.firebaseapp.com",
    projectId: "sklepaga-8790e",
    storageBucket: "sklepaga-8790e.firebasestorage.app",
    messagingSenderId: "815409129057",
    appId: "1:815409129057:web:9f6342be47e28c1f69ec20",
    measurementId: "G-9GH707G2WZ"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function loadUsers() {
    const tableBody = document.getElementById("users-tbody");
    tableBody.innerHTML = "";

    const querySnapshot = await getDocs(collection(db, "user"));
    if (querySnapshot.empty) {
      tableBody.innerHTML = `<tr><td colspan="5">No registered users.</td></tr>`;
      return;
    }

    querySnapshot.forEach(docSnap => {
      const data = docSnap.data();
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${data.id || docSnap.id}</td>
        <td>${data.name || ""}</td>
        <td>${data["e-mail"] || ""}</td>
        <td>${data.date || ""}</td>
        <td>
          <button data-id="${docSnap.id}" class="edit-btn">Edit</button>
          <button data-id="${docSnap.id}" class="delete-btn">Delete</button>
        </td>
      `;

      tableBody.appendChild(tr);
    });

    document.querySelectorAll(".edit-btn").forEach(btn => {
      btn.addEventListener("click", e => {
        const id = e.target.dataset.id;
        window.location.href = `register.html?id=${id}`;
      });
    });

    document.querySelectorAll(".delete-btn").forEach(btn => {
      btn.addEventListener("click", async e => {
        const id = e.target.dataset.id;
        if (confirm("Are you sure you want to delete this user?")) {
          try {
            await deleteDoc(doc(db, "user", id));
            alert("User deleted.");
            loadUsers();
          } catch (err) {
            alert("Failed to delete user: " + err.message);
          }
        }
      });
    });
  }

  window.addEventListener("DOMContentLoaded", () => {
    document.getElementById("add-user-btn").addEventListener("click", () => {
      window.location.href = "register.html";
    });

    loadUsers();
  });
</script>

<style>
  table {
    border-collapse: collapse;
    width: 100%;
    max-width: 900px;
    margin: 1rem auto;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 0.4rem 0.6rem;
    text-align: left;
  }
  th {
    background-color: #eee;
  }
  button {
    margin-right: 0.5rem;
  }
</style>
</head>
<body>
  <h1>Registered Users</h1>
  <button id="add-user-btn">Add User</button>
  <table>
    <thead>
      <tr>
        <th>ID</th><th>Name</th><th>E-mail</th><th>Date Registered</th><th>Actions</th>
      </tr>
    </thead>
    <tbody id="users-tbody">
      <tr><td colspan="5">Loading users...</td></tr>
    </tbody>
  </table>
</body>
</html>
    