<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Loading Article...</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.gstatic.com/s/inter/v12/1Pn0EnyXJmdSgbTxHLk.woff2" as="font" type="font/woff2"
        crossorigin="anonymous">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fontfaceobserver/2.1.0/fontfaceobserver.standalone.js"></script>

    <link rel="prefetch" href="home.html" as="document">

    <link rel="stylesheet" href="navbar\navbar.css">
    <link rel="stylesheet" href="font\font.css">
    <link rel="stylesheet" href="animations/global.css">
    <link rel="stylesheet" href="pages\index.css">
    <link rel="stylesheet" href="controlers\scroll.css">
    <link rel="stylesheet" href="sections/hero.css">
    <link rel="stylesheet" href="sections\carousel.css">

    <style>
        body.preload {
            visibility: hidden;
            opacity: 0;
        }

        body {
            transition: opacity 0.2s ease-in;
        }

        /* Essential for full-page article content below the fixed nav */
        #article-content-wrapper {
            padding-top: 3rem; /* Height of your fixed navbar (h-12) */
        }
    </style>

</head>

<body class="preload">
    <main id="swup" class="transition-fade">
        <div class="main-content text-container" id="article-content-wrapper">

            <nav id="navbar" class="duration-300 fixed inset-x-0 top-0 z-50 h-12 w-full">
                <div class="w-full h-full bg-white dark:bg-[#242424] px-3">
                    <div class="flex items-center justify-between h-full max-w-screen-xl mx-auto">
                        <a href="index.html" class="flex items-center space-x-2" data-transition rel="nofollow noopener">
                            <img src="https://sklepagatesting.github.io/resources/Images/sklogo.webp" alt="Logo" class="h-5 w-auto" />
                            <span class="font-theme font-medium">SK Lepaga</span>
                        </a>
                        <button id="menu-toggle-btn" type="button"
                            class="font-theme rounded-md hover:bg-[#e8e8e8] dark:hover:bg-[#696969] focus:outline-none"
                            aria-controls="sidebar-multi-level-sidebar" aria-expanded="false">
                            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path id="menu-icon-path" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </div>
                </div>
            </nav>

            <aside id="sidebar-multi-level-sidebar"
                class="fixed top-12 left-0 z-30 w-[100vw] hidden transition-[max-height] duration-500 bg-white dark:bg-[#242424]"
                style="height: calc(100vh - 3rem); overflow-y: auto;" aria-label="Sidebar">
                <div class="h-full flex items-center justify-center px-4 py-4 max-w-4xl mx-auto">
                    <div id="sidebar-menu" class="font-theme space-y-5 flex flex-col items-center justify-center">
                        <div class="sidebar-menu-item flex flex-col items-center">
                            <button class="sidebar-menu-header flex items-center space-x-2 focus:outline-none">
                                <h2 class="subtext-title">CALENDAR</h2>
                                <svg class="w-5 h-5 stroke-white transition-transform duration-300" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <div
                                class="font-theme sidebar-menu-body max-h-0 overflow-hidden opacity-0 transition-all duration-500 ease-in-out mt-3 space-y-1 text-center flex flex-col items-center">
                                <a href="#" class="subtext submenu-link inline-block">Happening Now</a>
                                <a href="#" class="subtext submenu-link inline-block">Upcoming Activities</a>
                                <br>
                            </div>
                        </div>
                        <div class="sidebar-menu-item flex flex-col items-center">
                            <button class="sidebar-menu-header flex items-center space-x-2 focus:outline-none">
                                <h2 class="font-theme subtext-title">NEWS</h2>
                                <svg class="w-5 h-5 stroke-white transition-transform duration-300" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <div
                                class="sidebar-menu-body max-h-0 overflow-hidden opacity-0 transition-all duration-500 ease-in-out mt-3 space-y-1 text-center flex flex-col items-center">
                                <a href="#" class="subtext submenu-link block text-[#FFFFF]">Featured News</a>
                                <a href="#" class="subtext submenu-link block text-[#FFFFF]">All Articles</a>
                                <br>
                            </div>
                        </div>
                        <div class="sidebar-menu-item flex flex-col items-center">
                            <button class="sidebar-menu-header flex items-center space-x-2 focus:outline-none">
                                <h2 class="subtext-title">ABOUT</h2>
                                <svg class="w-5 h-5 stroke-white transition-transform duration-300" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <div
                                class="sidebar-menu-body max-h-0 overflow-hidden opacity-0 transition-all duration-500 ease-in-out mt-3 space-y-1 text-center flex flex-col items-center">
                                <a href="#" class="subtext submenu-link block text-[#FFFFF]">What is SK</a>
                                <a href="#" class="subtext submenu-link block text-[#FFFFF]">SK Officials</a>
                                <a href="#" class="subtext submenu-link block text-[#FFFFF]">About Developers</a>
                                <br>
                            </div>
                        </div>
                        <div class="sidebar-menu-item flex flex-col items-center">
                            <button class="sidebar-menu-header flex items-center space-x-2 focus:outline-none">
                                <h2 class="subtext-title">CONTACT</h2>
                                <svg class="w-5 h-5 stroke-white transition-transform duration-300" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <div
                                class="sidebar-menu-body max-h-0 overflow-hidden opacity-0 transition-all duration-500 ease-in-out mt-3 space-y-1 text-center flex flex-col items-center">
                                <a href="pages/article1.html" class="subtext submenu-link block text-[#FFFFF]">Send a message</a>
                                <a href="#" class="subtext submenu-link block text-[#FFFFF]">Send a feedback</a>
                                <a href="#" class="subtext submenu-link block text-[#FFFFF]">Schedule a meetup</a>
                                <br>
                            </div>
                        </div>
                        <div class="sidebar-menu-item flex flex-col items-center">
                            <button class="sidebar-menu-header flex items-center space-x-2 focus:outline-none">
                                <h2 href="pages/article1.html" class="subtext-title">SITE MAP</h2>
                                <svg class="w-5 h-5 stroke-white transition-transform duration-300" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <div
                                class="sidebar-menu-body max-h-0 overflow-hidden opacity-0 transition-all duration-500 ease-in-out mt-3 space-y-1 text-center flex flex-col items-center">
                                <br>
                            </div>
                        </div>

                    </div>
                </div>
            </aside>

            <section class="font-theme px-4 py-8 sm:py-16 bg-white dark:bg-[#242424]">
                <div class="max-w-screen-xl mx-auto px-4 pb-6 sm:pb-8 pt-10 sm:pt-24">

                    <div id="loading-or-error" class="text-center py-20">
                        <p class="text-xl text-gray-700 dark:text-gray-300">Loading article...</p>
                    </div>

                    <div id="article-main" class="hidden">
                        
                        <div class="text-container">
                            <h2 id="article-category" class="rise subtext text-gray-400 mt-4 uppercase"></h2>
                        </div>

                        <div class="text-container">
                            <h2 id="article-title" class="text-line subtext-title font-theme mt-6 sm:mt-8 mb-6 sm:mb-8">
                                
                            </h2>
                        </div>

                        <div class="max-w-screen-xl mx-auto">
                            <div class="zoom parallax flex flex-col mx-auto overflow-hidden relative z-10 image-parallax-sizing"
                                data-dark-border="#242424">
                                <img id="article-image" src="" alt="Article Featured Image" class="w-full h-auto object-cover">
                            </div>
                        </div>


                        <div class="container max-w-5xl py-6 sm:py-12">
                            <div class="grid gap-2 sm:grid-cols-2 text-left">

                                <div>
                                    <div
                                        class="text-left mt-4 mb-10 sm:mb-14 before:block before:w-24 before:h-3 before:mb-5 before:rounded-full before:bg-violet-600 dark:before:bg-violet-400">
                                        <h3 class="rise context font-medium text-gray-700 dark:text-gray-300">
                                            Published: <span id="article-date" class="font-bold"></span><br>
                                            By: <span id="article-author" class="font-bold"></span><br>
                                            Category: <span id="article-category-meta" class="font-bold"></span><br>
                                            <span class="text-xs text-gray-400">Slug: <span id="article-slug"></span></span>
                                        </h3>
                                    </div>
                                </div>

                                <div class="relative px-4 space-y-6">
                                    <div
                                        class="space-y-10 sm:space-y-8 relative px-4 sm:before:absolute sm:before:top-2 sm:before:bottom-0 sm:before:w-0.5 sm:before:-left-3 before:bg-gray-300 dark:before:bg-gray-700">

                                        <div
                                            class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-4 sm:before:h-4 sm:before:rounded-full sm:before:left-[-35px] sm:before:z-[1] before:bg-violet-600 dark:before:bg-violet-400">
                                            <h3 class="rise subtext font-bold">Article Context</h3>
                                            <p id="article-context" class="left-in-slow context dark:text-gray-400 whitespace-pre-wrap"></p>
                                        </div>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>
            </section>


            <footer
                class="footer relative bg-white dark:bg-[#242424] text-gray-700 dark:text-gray-300 antialiased pt-12 pb-6 border-t border-gray-100 dark:border-gray-800">
                <div class="footer-tint absolute inset-0 pointer-events-none opacity-0 transition-opacity duration-500"></div>

                <div
                    class="relative z-10 max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col items-center">

                    <div class="flex flex-col items-center space-y-4 mb-10 text-center">
                        <a href="index.html"
                            class="relative subtext-title uppercase transition-colors duration-300 hover:text-black dark:hover:text-white after:absolute after:bottom-0 after:left-0 after:h-0.5 after:w-0 after:bg-current after:transition-all after:duration-300 hover:after:w-full"
                            data-transition>HOME</a>
                        <a href="/calendar"
                            class="relative subtext-title uppercase transition-colors duration-300 hover:text-black dark:hover:text-white after:absolute after:bottom-0 after:left-0 after:h-0.5 after:w-0 after:bg-current after:transition-all after:duration-300 hover:after:w-full"
                            data-transition>CALENDAR</a>
                        <a href="/news"
                            class="relative subtext-title uppercase transition-colors duration-300 hover:text-black dark:hover:text-white after:absolute after:bottom-0 after:left-0 after:h-0.5 after:w-0 after:bg-current after:transition-all after:duration-300 hover:after:w-full"
                            data-transition>NEWS</a>
                        <a href="/about"
                            class="relative subtext-title uppercase transition-colors duration-300 hover:text-black dark:hover:text-white after:absolute after:bottom-0 after:left-0 after:h-0.5 after:w-0 after:bg-current after:transition-all after:duration-300 hover:after:w-full"
                            data-transition>ABOUT</a>
                        <a href="/contact"
                            class="relative subtext-title uppercase transition-colors duration-300 hover:text-black dark:hover:text-white after:absolute after:bottom-0 after:left-0 after:h-0.5 after:w-0 after:bg-current after:transition-all after:duration-300 hover:after:w-full"
                            data-transition>CONTACT</a>
                        <a href="/sitemap"
                            class="relative subtext-title uppercase transition-colors duration-300 hover:text-black dark:hover:text-white after:absolute after:bottom-0 after:left-0 after:h-0.5 after:w-0 after:bg-current after:transition-all after:duration-300 hover:after:w-full"
                            data-transition>SITE MAP</a>
                    </div>

                    <hr class="w-24 border-t border-gray-300 dark:border-gray-700 mb-8" />

                    <div class="flex space-x-8 mb-10">
                        <a href="#"
                            class="social-icon text-gray-500 hover:text-blue-600 dark:hover:text-blue-400 transform hover:scale-110 transition-transform duration-300"
                            data-tint="rgba(59, 130, 246, 0.5)" aria-label="Facebook">
                            <svg class="w-7 h-7" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                                viewBox="0 0 24 24">
                                <path
                                    d="M22 12a10 10 0 1 0-11.5 9.9v-7h-2v-3h2v-2.3c0-2 1.2-3.1 3-3.1.9 0 1.8.2 1.8.2v2h-1c-1 0-1.3.6-1.3 1.2V12h2.5l-.4 3h-2.1v7A10 10 0 0 0 22 12" />
                            </svg>
                        </a>

                        <a href="mailto:info@example.com"
                            class="social-icon text-gray-500 hover:text-red-600 dark:hover:text-red-400 transform hover:scale-110 transition-transform duration-300"
                            data-tint="rgba(239, 68, 68, 0.5)" aria-label="Email">
                            <svg class="w-7 h-7" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24">
                                <rect x="3" y="5" width="18" height="14" rx="2" ry="2" stroke="currentColor"
                                    stroke-width="2" />
                                <path d="M3 7l9 6 9-6" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </a>

                        <a href="tel:5551234567"
                            class="social-icon text-gray-500 hover:text-green-600 dark:hover:text-green-400 transform hover:scale-110 transition-transform duration-300"
                            data-tint="rgba(34, 197, 94, 0.5)" aria-label="Phone">
                            <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round"
                                    d="M2 5a2 2 0 0 1 2-2h3.3a1 1 0 0 1 .95.68l1.2 3.66a1 1 0 0 1-.27 1.04l-1.9 1.9a16.06 16.06 0 0 0 6.87 6.87l1.9-1.9a1 1 0 0 1 1.04-.27l3.7 1.2a1 1 0 0 1 .68.95V20a2 2 0 0 1-2 2h-1C10.6 22 2 13.4 2 3V2Z" />
                            </svg>
                        </a>
                    </div>

                    <div class="text-sm space-y-2 text-center">
                        <p class="context text-gray-600 dark:text-gray-400 font-medium">Developed by <strong>Your Company Name</strong></p>
                        <p class="context text-gray-500 dark:text-gray-500">
                            &copy; <strong id="current-year">2024</strong> All Rights Reserved.
                        </p>
                    </div>
                </div>
            </footer>
        </div>


        <style>
            .footer-tint {
                background: linear-gradient(to top, var(--tint-color, transparent) 70%, transparent 100%);
            }
        </style>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                document.getElementById('current-year').textContent = new Date().getFullYear();

                const tintLayer = document.querySelector('.footer-tint');
                const icons = document.querySelectorAll('.social-icon');

                icons.forEach(icon => {
                    icon.addEventListener('mouseenter', () => {
                        tintLayer.style.setProperty('--tint-color', icon.getAttribute('data-tint'));
                        tintLayer.classList.add('opacity-100');
                    });
                    icon.addEventListener('mouseleave', () => {
                        tintLayer.classList.remove('opacity-100');
                    });
                });
            });
        </script>

    </main>


    <script>
        // IMPORTANT: Replace with your actual Firebase config/Project ID
        const FIREBASE_PROJECT_ID = 'sklepaga-8790e'; 
        const JSON_URL = `https://firestore.googleapis.com/v1/projects/${FIREBASE_PROJECT_ID}/databases/(default)/documents/contentJson/data`; 

        const articleMain = document.getElementById('article-main');
        const loadingOrError = document.getElementById('loading-or-error');
        
        // Helper function to extract a simple value from the complex Firestore REST API response structure
        const extractValue = (field) => {
            if (!field) return null;
            if (field.stringValue) return field.stringValue;
            if (field.integerValue) return parseInt(field.integerValue);
            return null;
        };

        // 🟢 CORRECT FUNCTION TO READ THE SLUG FROM THE URL: article.html?slug=example-slug
        function getSlugFromUrl() {
            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug'); // Looks for the 'slug' parameter
            if (slug) {
                return slug;
            }
            // Fallback check for 'id' 
            return params.get('id'); 
        }

        async function loadArticle() {
            const targetSlug = getSlugFromUrl(); // Use the updated function
            
            if (!targetSlug) {
                loadingOrError.innerHTML = '<p class="text-xl text-red-500">Error: Article slug not found in URL (missing ?slug=).</p>';
                loadingOrError.classList.remove('hidden');
                articleMain.classList.add('hidden');
                return;
            }

            loadingOrError.innerHTML = '<p class="text-xl text-gray-700 dark:text-gray-300">Loading article...</p>';
            loadingOrError.classList.remove('hidden');
            articleMain.classList.add('hidden');

            try {
                // Fetch the entire content cache
                const response = await fetch(`${JSON_URL}?t=${Date.now()}`, { cache: "no-cache" });
                if (!response.ok) throw new Error(`HTTP status ${response.status}`);

                const data = await response.json();
                const rawContentValues = data.fields?.content?.arrayValue?.values || [];
                
                let articleData = null;

                // Loop through all items to find the one matching the slug
                for (const item of rawContentValues) {
                    const fields = item.mapValue?.fields;
                    if (!fields) continue;

                    const itemSlug = extractValue(fields.slug);

                    if (itemSlug === targetSlug) {
                        articleData = {
                            title: extractValue(fields.title),
                            slug: itemSlug,
                            datePublished: extractValue(fields.timestamp), // Using timestamp field for date
                            context: extractValue(fields.context),
                            image: extractValue(fields.image),
                            category: extractValue(fields.category),
                            author: extractValue(fields.author) || 'SK Lepaga Council',
                        };
                        break;
                    }
                }

                if (!articleData) {
                    loadingOrError.innerHTML = `<p class="text-xl text-red-500">Article with slug "${targetSlug}" not found in database.</p>`;
                    return;
                }

                // 4. RENDER THE CONTENT
                document.getElementById('page-title').textContent = articleData.title;
                document.getElementById('article-category').textContent = articleData.category;
                document.getElementById('article-category-meta').textContent = articleData.category;
                document.getElementById('article-title').textContent = articleData.title;
                document.getElementById('article-image').src = articleData.image;
                document.getElementById('article-image').alt = articleData.title; 
                
                // Format the timestamp to a readable date
                const dateObj = articleData.datePublished ? new Date(articleData.datePublished * 1000) : new Date();
                document.getElementById('article-date').textContent = dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                
                document.getElementById('article-author').textContent = articleData.author;
                document.getElementById('article-slug').textContent = articleData.slug;
                document.getElementById('article-context').textContent = articleData.context;
                
                // Show content
                loadingOrError.classList.add('hidden');
                articleMain.classList.remove('hidden');
                
            } catch (error) {
                console.error("Failed to load article:", error);
                loadingOrError.innerHTML = `<p class="text-xl text-red-500">Failed to load content: ${error.message}</p>`;
            }
        }

        window.addEventListener("DOMContentLoaded", loadArticle);
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite/dist/flowbite.min.js"></script>

    <script src="navbar\navbar.js"></script>
    <script src="pages/index.js"></script>
    <script src="pages/home.js"></script>
    <script src="animations\global.js"></script>
    <script src="font\font.js"></script>
    <script src="loader\loaders.js"></script>
    <script src="loader\others.js"></script>
    <script src="animations/scroll.js"></script>

    <script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
    <script src="https://unpkg.com/gsap@3/dist/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/gsap@3/dist/gsap-core.min.js"></script>
    <script src="https://unpkg.com/gsap@3/dist/MotionPathPlugin.min.js"></script>
    <script src="https://unpkg.com/gsap@3/dist/ScrollToPlugin.min.js"></script>
    <script src="https://unpkg.com/gsap@3/dist/Draggable.min.js"></script>
    <script src="https://unpkg.com/gsap@3/dist/EasePack.min.js"></script>
    <script src="https://unpkg.com/gsap@3/dist/ModifiersPlugin.min.js"></script>
    <script src="https://unpkg.com/gsap@3.12.2/dist/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Flip.min.js"></script>
    <script src="https://unpkg.com/swup@latest/dist/swup.min.js"></script>

    <script>
        // GSAP Animations (Retained and slightly modified for the single image)
        window.addEventListener("DOMContentLoaded", () => {
            // Animation for the main image element
            const target = document.querySelector(".zoom.parallax");
            if(target) {
                gsap.fromTo(
                    target,
                    { scale: 0, transformOrigin: "bottom left" },
                    {
                        scale: 1,
                        duration: 2,
                        ease: "power2.inOut" 
                    }
                );
            }
        });
    </script>


</body>

</html>
