<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>News Update</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="preload"
      href="https://fonts.gstatic.com/s/inter/v12/1Pn0EnyXJmdSgbTxHLk.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fontfaceobserver/2.1.0/fontfaceobserver.standalone.js"></script>

    <link rel="prefetch" href="home.html" as="document" />
    <link rel="stylesheet" href="navbar\navbar.css" />
    <link rel="stylesheet" href="font\font.css" />
    <link rel="stylesheet" href="animations/global.css" />
    <link rel="stylesheet" href="pages\index.css" />
    <link rel="stylesheet" href="controlers\scroll.css" />
    <link rel="stylesheet" href="sections/hero.css" />
    <link rel="stylesheet" href="sections\carousel.css" />
    <style>
      :root {
        --nav-height: 3rem;
      }

      html,
      body {
        height: 100vh;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      body.preload {
        visibility: hidden;
        opacity: 0;
      }

      body {
        transition: opacity 0.2s ease-in;
        overflow-x: hidden;
      }
      /* Main content container fills the entire viewport. */
      .main-content {
        position: relative;
        height: 100vh;
        width: 100%;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .images-container {
        flex-grow: 1;
        z-index: 10;
        width: 100%;
        position: relative;

        display: flex;
        flex-direction: column; /* Allows hero and carousel to stack */
        align-items: center;

        padding-top: calc(var(--nav-height) + 1rem);
      }

      #hero-news-image {
        flex-grow: 1; /* Hero image takes up max space */
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0 1rem; /* Padding for small screens */
      }

      .hero-image-wrapper {
        width: 100%;
        height: 100%;
        max-width: 900px; /* Constrain max size */
        max-height: 50vh; /* Constrain max size by height */
        display: block;
        overflow: hidden;
      }
      
      .hero-image-wrapper img {
          width: 100%;
          height: 100%;
          object-fit: cover;
      }

      .video-titles-container {
        z-index: 20;
        background: transparent;
        padding: 2rem;
        width: 100%;
        position: absolute;
        bottom: 0;
        left: 0;
      }
      .carousel-image {
        width: clamp(200px, 40vw, 400px);
        aspect-ratio: 16 / 9;
        height: auto;
        max-height: 40vh;
        object-fit: cover;
      }

      .video-reel {
        width: clamp(100px, 30vw, 300px);
      }
      /* Ensure nav and aside are always on top */
      #navbar,
      #sidebar-multi-level-sidebar {
        z-index: 30 !important;
      }

      /* Prevent any potential overflow */
      * {
        box-sizing: border-box;
      }
    </style>
  </head>
  <body class="preload">
    <main id="swup">
      <div class="main-content text-container">
        <nav
          id="navbar"
          class="duration-300 fixed inset-x-0 top-0 z-50 h-12 w-full"
        >
          <div class="w-full h-full bg-white dark:bg-[#242424] px-3">
            <div
              class="flex items-center justify-between h-full max-w-screen-xl mx-auto"
            >
              <a
                href=""
                class="relative z-60 pointer-events-auto flex items-center space-x-2"
              >
                <img
                  src="https://sklepagatesting.github.io/resources/Images/sklogo.webp"
                  alt="Logo"
                  class="h-5 w-auto"
                />
                <span class="font-theme font-medium">SK Lepaga</span>
              </a>
              <button
                id="menu-toggle-btn"
                type="button"
                class="font-theme rounded-md hover:bg-[#e8e8e8] dark:hover:bg-[#696969] focus:outline-none"
                aria-controls="sidebar-multi-level-sidebar"
                aria-expanded="false"
              >
                <svg
                  class="w-7 h-7"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    id="menu-icon-path"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 6h16M4 12h16M4 18h16"
                  />
                </svg>
              </button>
            </div>
          </div>
        </nav>

        <aside
          id="sidebar-multi-level-sidebar"
          class="fixed top-12 left-0 z-30 w-[100vw] hidden transition-[max-height] duration-500 bg-white dark:bg-[#242424]"
          style="height: calc(100vh - 3rem); overflow-y: auto"
          aria-label="Sidebar"
        >
          <div
            class="h-full flex items-center justify-center px-4 py-4 max-w-4xl mx-auto"
          >
            <div
              id="sidebar-menu"
              class="font-theme space-y-5 flex flex-col items-center justify-center"
            >
              <div class="sidebar-menu-item flex flex-col items-center">
                <button
                  class="sidebar-menu-header flex items-center space-x-2 focus:outline-none"
                >
                  <h2 class="subtext-title">CALENDAR</h2>
                  <svg
                    class="w-5 h-5 stroke-white transition-transform duration-300"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </button>
                <div
                  class="font-theme sidebar-menu-body max-h-0 overflow-hidden opacity-0 transition-all duration-500 ease-in-out mt-3 space-y-1 text-center flex flex-col items-center"
                >
                  <a href="#" class="subtext submenu-link inline-block"
                    >Happening Now</a
                  >
                  <a href="#" class="subtext submenu-link inline-block"
                    >Upcoming Activities</a
                  >
                  <br />
                </div>
              </div>
              <div class="sidebar-menu-item flex flex-col items-center">
                <button
                  class="sidebar-menu-header flex items-center space-x-2 focus:outline-none"
                >
                  <h2 class="font-theme subtext-title">NEWS</h2>
                  <svg
                    class="w-5 h-5 stroke-white transition-transform duration-300"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </button>
                <div
                  class="sidebar-menu-body max-h-0 overflow-hidden opacity-0 transition-all duration-500 ease-in-out mt-3 space-y-1 text-center flex flex-col items-center"
                >
                  <a href="#" class="subtext submenu-link block text-[#FFFFF]"
                    >Featured News</a
                  >
                  <a href="#" class="subtext submenu-link block text-[#FFFFF]"
                    >All Articles</a
                  >
                  <br />
                </div>
              </div>
              <div class="sidebar-menu-item flex flex-col items-center">
                <button
                  class="sidebar-menu-header flex items-center space-x-2 focus:outline-none"
                >
                  <h2 class="subtext-title">ABOUT</h2>
                  <svg
                    class="w-5 h-5 stroke-white transition-transform duration-300"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </button>
                <div
                  class="sidebar-menu-body max-h-0 overflow-hidden opacity-0 transition-all duration-500 ease-in-out mt-3 space-y-1 text-center flex flex-col items-center"
                >
                  <a href="#" class="subtext submenu-link block text-[#FFFFF]"
                    >What is SK</a
                  >
                  <a href="#" class="subtext submenu-link block text-[#FFFFF]"
                    >SK Officials</a
                  >
                  <a href="#" class="subtext submenu-link block text-[#FFFFF]"
                    >About Developers</a
                  >
                  <br />
                </div>
              </div>
              <div class="sidebar-menu-item flex flex-col items-center">
                <button
                  class="sidebar-menu-header flex items-center space-x-2 focus:outline-none"
                >
                  <h2 class="subtext-title">CONTACT</h2>
                  <svg
                    class="w-5 h-5 stroke-white transition-transform duration-300"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </button>
                <div
                  class="sidebar-menu-body max-h-0 overflow-hidden opacity-0 transition-all duration-500 ease-in-out mt-3 space-y-1 text-center flex flex-col items-center"
                >
                  <a
                    href="authentication.html"
                    class="subtext submenu-link block text-[#FFFFF]"
                    >Real-time Chat</a
                  >
                  <a
                    href="contactbeta.html"
                    class="subtext submenu-link block text-[#FFFFF]"
                    >Send a message</a
                  >
                  <a href="#" class="subtext submenu-link block text-[#FFFFF]"
                    >Schedule a meetup</a
                  >
                  <br />
                </div>
              </div>
              <div class="sidebar-menu-item flex flex-col items-center">
                <button
                  class="sidebar-menu-header flex items-center space-x-2 focus:outline-none"
                >
                  <h2 href="pages/article1.html" class="subtext-title">
                    SITE MAP
                  </h2>
                  <svg
                    class="w-5 h-5 stroke-white transition-transform duration-300"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </button>
                <div
                  class="sidebar-menu-body max-h-0 overflow-hidden opacity-0 transition-all duration-500 ease-in-out mt-3 space-y-1 text-center flex flex-col items-center"
                >
                  <br />
                </div>
              </div>
            </div>
          </div>
        </aside>

        <section
          class="clipp-section images-container w-full flex flex-col justify-between bg-white overflow-hidden bg-white dark:bg-[#242424]"
        >
          <div
            id="hero-news-image"
            class="w-full h-full p-4 flex items-center justify-center"
          >
            <p class="text-gray-500">Loading latest news...</p>
          </div>

          <div class="w-full pb-4 px-0">
            <div class="overflow-hidden relative w-full">
              <div id="scroller" class="flex w-max will-change-transform">
                <p class="text-gray-500 p-4">Loading other news...</p>
              </div>
            </div>
          </div>
        </section>

        <section class="video-titles-container w-full bg-transparent mt-0 pt-0">
          <div class="w-full flex flex-col-reverse md:flex-row">
            <div class="hero w-full md:w-3/8 mb-8 md:mb-0 flex items-end relative">
              <div class="flex flex-col justify-end">
                <p class="mb-4 text-sm font-theme">Play Reel ▶</p>
                <div class="w-full max-w-sm">
                  <video
                    id="playReel"
                    src="https://sklepagatesting.github.io/resources/Images/reel.mp4"
                    autoplay
                    loop
                    muted
                    playsinline
                    class="video-reel shadow-lg object-cover aspect-video cursor-pointer"
                  ></video>
                </div>
              </div>
            </div>
            <div id="videoOverlayBg" class="video-overlay-bg"></div>

            <div
              class="w-full md:w-5/8 flex flex-col justify-end sm:text-left md:text-left"
            >
              <div>
                <div class="text-container">
                  <h2 class="text-line context font-theme mb-2">
                    Latest Headline Context
                  </h2>
                </div>
                <div class="text-container">
                  <h1 class="text-line subtext-title font-theme">Latest</h1>
                </div>
                <div class="text-container">
                  <h1 class="text-line subtext-title font-theme">
                    News Article
                  </h1>
                </div>
                <div class="text-container mb-4">
                  <h1 class="text-line subtext-title font-theme">Title</h1>
                </div>
                <div class="text-container mb-4">
                  <p class="text-line subtext font-theme">Article Subtitle</p>
                </div>
                <div class="text-container">
                  <a
                    href="#"
                    class="text-line context inline-block w-fit font-theme border-b border-black hover:opacity-75 transition"
                    data-transition
                    rel="nofollow noopener"
                  >
                    Explore All Work
                  </a>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite/dist/flowbite.min.js"></script>

    <script src="navbar\navbar.js"></script>
    <script src="pages/index.js"></script>
    <script src="animations\globalindex.js"></script>
    <script src="font\font.js"></script>
    <script src="loader\loaders.js"></script>
    <script src="loader\others.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Flip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fontfaceobserver/2.1.0/fontfaceobserver.standalone.js"></script>
    <script src="https://unpkg.com/swup@latest/dist/swup.min.js"></script>

    <script>
      // GSAP Animation for section reveal
      window.addEventListener('DOMContentLoaded', () => {
        gsap.utils.toArray('.clipp-section').forEach((section, index) => {
          gsap.to(section, {
            clipPath: 'inset(0% 0% 0% 0%)', // Reveal fully
            duration: 0.7,
            ease: 'power2.out',
          });
        });
      });
    </script>

    <script>
      // Helper function to extract a simple value from the complex Firestore REST API response structure
      const extractValue = (field) => {
        if (!field) return null;
        if (field.stringValue) return field.stringValue;
        if (field.integerValue) return parseInt(field.integerValue);
        return null;
      };

      async function fetchAndRenderNews() {
        const JSON_URL =
          'https://firestore.googleapis.com/v1/projects/sklepaga-8790e/databases/(default)/documents/contentJson/data';
        const scroller = document.getElementById('scroller');
        const heroImageContainer = document.getElementById('hero-news-image');

        // Target text elements to update with Hero details
        const contextLine = document.querySelector('.text-line.context');
        const titleLines = document.querySelectorAll('.text-line.subtext-title');
        const subtextLine = document.querySelector('.text-line.subtext');
        const exploreLink = document.querySelector('.text-line.context[data-transition]');

        if (!scroller || !heroImageContainer) return;

        // Reset display while loading
        scroller.innerHTML = '<p class="text-gray-500 p-4">Loading news...</p>';
        heroImageContainer.innerHTML =
          '<p class="text-gray-500 p-4">Loading latest news...</p>';

        try {
          const cacheBustingURL = `${JSON_URL}?t=${Date.now()}`;
          const response = await fetch(cacheBustingURL, {
            cache: 'no-cache',
          });

          if (!response.ok) {
            throw new Error(`HTTP status ${response.status}`);
          }

          let data = await response.json();
          let contentArray = [];
          const rawContentValues = data.fields?.content?.arrayValue?.values;

          if (rawContentValues && Array.isArray(rawContentValues)) {
            contentArray = rawContentValues
              .map((item) => {
                const fields = item.mapValue?.fields;
                if (!fields) return null;

                return {
                  id: extractValue(fields.id) || 'default',
                  title: extractValue(fields.title),
                  slug: extractValue(fields.slug),
                  context: extractValue(fields.context),
                  image: extractValue(fields.image),
                  category: extractValue(fields.category),
                  timestamp: extractValue(fields.timestamp),
                };
              })
              .filter((item) => item !== null);
          } else {
            console.warn('No content array found in Firestore document.');
          }

          // 1. Filter for 'news' and sort by timestamp (newest first)
          const newsContent = contentArray
            .filter((item) => item.category === 'news')
            .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

          if (newsContent.length === 0) {
            heroImageContainer.innerHTML =
              "<p class='text-gray-500 p-4'>No news articles found.</p>";
            scroller.innerHTML = '';
            return;
          }

          // 2. Separate Hero (Latest) and Carousel (Next 4)
          const heroArticle = newsContent[0];
          // Take the next 4 articles for the carousel, starting from index 1
          const carouselArticles = newsContent.slice(1, 5);

          // --- RENDER HERO SECTION (Image and Text Details) ---
          if (heroArticle) {
            const linkHref = heroArticle.slug
              ? `newsarticle.html?slug=${heroArticle.slug}`
              : `newsarticle.html?id=${heroArticle.id}`;

            // A. Inject the Hero Image
            heroImageContainer.innerHTML = `
              <a href="${linkHref}" data-transition rel="nofollow noopener" class="hero-image-wrapper shadow-lg">
                  <img 
                      src="${heroArticle.image}" 
                      alt="${heroArticle.title}" 
                  />
              </a>
            `;

            // B. Inject Hero Text Details into the fixed text area
            if (contextLine)
              contextLine.textContent = heroArticle.context || 'Latest News Update';
            
            // Assuming your default text setup requires three lines for the title/heading area
            if (titleLines[0]) titleLines[0].textContent = 'LATEST';
            if (titleLines[1]) titleLines[1].textContent = heroArticle.title.split(' ')[0] || '';
            if (titleLines[2]) titleLines[2].textContent = heroArticle.title.split(' ').slice(1).join(' ') || 'NEWS';
            
            if (subtextLine) subtextLine.textContent = heroArticle.title;
            if (exploreLink) {
              exploreLink.textContent = 'Read Full Article →';
              exploreLink.href = linkHref;
            }
          } else {
            heroImageContainer.innerHTML =
              "<p class='text-gray-500 p-4'>No latest news article found.</p>";
          }

          // --- RENDER CAROUSEL SECTION (Next 4 News Items) ---
          if (carouselArticles.length > 0) {
            const carouselHTML = carouselArticles
              .map((item) => {
                const linkHref = item.slug
                  ? `newsarticle.html?slug=${item.slug}`
                  : `newsarticle.html?id=${item.id}`;

                return `
                  <a href="${linkHref}" class="group relative flex-shrink-0 mr-8" data-transition rel="nofollow noopener">
                      <div class="zoom overflow-hidden relative carousel-image">
                          <img
                              src="${item.image}"
                              alt="${item.title}"
                              class="w-full h-full object-cover"
                          />
                      </div>
                      <div class="w-full pt-2 overflow-hidden">
                          <p class="context font-theme sm:translate-y-full sm:group-hover:translate-y-0 transition-transform duration-500 ease-in-out">
                              ${item.title}
                          </p>
                      </div>
                  </a>
              `;
              })
              .join('');

            scroller.innerHTML = carouselHTML;
          } else {
            scroller.innerHTML =
              "<p class='text-gray-500 p-4'>No other news available for the carousel.</p>";
          }
        } catch (error) {
          console.error('Failed to load and render content from JSON:', error);
          heroImageContainer.innerHTML = `<p class='text-red-500 p-4'>Error loading content. Check **Firebase Security Rules**. (${error.message})</p>`;
          scroller.innerHTML = '';
        }
      }
      // Run the function when the DOM content is fully loaded
      window.addEventListener('DOMContentLoaded', fetchAndRenderNews);
    </script>
  </body>
</html>
